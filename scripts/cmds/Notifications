module.exports = {
  config: {
    name: "noti",
    aliases: ["notification"],
    version: "1.0",
    author: "Samy Charles",
    role: 0,
    countDown: 5,
    category: "owner",
    shortDescription: "Envoyer une notification dans tous les groupes",
    longDescription: "Commande rÃ©servÃ©e au propriÃ©taire pour envoyer un message global.",
    guide: "{p}noti [message]"
  },

  onStart: async function ({ api, event, args }) {

    // TON ID SEUL
    const ownerID = "61582382664051";
    if (event.senderID !== ownerID)
      return api.sendMessage(
        "âŒ Cette commande est rÃ©servÃ©e au propriÃ©taire du bot.",
        event.threadID,
        event.messageID
      );

    const message = args.join(" ");
    if (!message)
      return api.sendMessage(
        "ğŸŒ¸âœ¨ ï¹@ ğ—”ğ—˜ğ—¦ğ—§ğ—›ğ—˜ğ—¥ğŸ€ğŸ¥™ï¹  :\nMerci dâ€™ajouter un message.\nExemple : noti BonjourğŸ’–",
        event.threadID,
        event.messageID
      );

    // RÃ©cupÃ©rer tous les groupes
    const threads = await api.getThreadList(100, null, ["INBOX"]);
    const groups = threads.filter(t => t.isGroup);

    const notiMessage = `
ğŸŒ¸âœ¨ â”€â”€ ğŸ€ ğ—¡ğ—¢ğ—§ğ—œğ—™ğ—œğ—–ğ—”ğ—§ğ—œğ—¢ğ—¡ ğŸ€ â”€â”€ âœ¨ğŸŒ¸
ğ— ğ—²ğ˜€ğ˜€ğ—®ğ—´ğ—² ğ—±ğ˜‚ ğ—°ğ—¿Ã©ğ—®ğ˜ğ—²ğ˜‚ğ—¿ :

ğŸ’Œ ã€ ${message} ã€ ğŸ’Œ

ğŸŒ¸âœ¨ ï¹@ ğ—”ğ—˜ğ—¦ğ—§ğ—›ğ—˜ğ—¥ğŸ€ğŸ¥™ï¹ 
`;

    // Envoyer dans chaque groupe
    for (const group of groups) {
      api.sendMessage(notiMessage, group.threadID);
      await new Promise(resolve => setTimeout(resolve, 700)); // pause pour Ã©viter le spam
    }

    return api.sendMessage(
      `ğŸŒ¸âœ¨ ï¹@ ğ—”ğ—˜ğ—¦ğ—§ğ—›ğ—˜ğ—¥ğŸ€ğŸ¥™ï¹  :\nâœ”ï¸ Notification envoyÃ©e dans ${groups.length} groupes ğŸ’–`,
      event.threadID,
      event.messageID
    );
  }
};
